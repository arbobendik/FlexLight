import{loadScript}from"./load-script.js";import{ConfigForm}from"./ui.js";import{Config}from"../flexlight/flexlight.js";import{FlexLight}from"../flexlight/flexlight.js";let canvas=document.createElement("canvas"),config=(document.body.appendChild(canvas),new Config),engine=new FlexLight(canvas),getStartValueCheckbox=e=>{var a=localStorage.getItem(e.name);if(a){if("true"===a)return!0;if("false"===a)return!1;throw new Error("Unsupported value: "+a)}return e.defaultValue},isNumber=e=>String(Number.parseFloat(e))===e,getStartValueSlider=e=>{var a=localStorage.getItem(e.name);if(a){if(isNumber(a))return Number(a);throw new Error("Unsupported value: "+a)}return e.defaultValue},getStartValueSelect=e=>{var a=localStorage.getItem(e.name);return a||e.defaultValue};document.addEventListener("DOMContentLoaded",()=>{var e,a=new URLSearchParams(location.search).get("v")??"example1",a=(loadScript(`./build/loader/examples/${a}.js`,"module"),document.getElementById("scriptForm")),t=document.getElementById("parameterForm");a&&t?(a=(e,a)=>{console.log(e,a),localStorage.setItem(e,a.toString())},(e=new ConfigForm(t,engine,a)).addSelect("Backend","api",["webgl2","webgpu"],getStartValueSelect({name:"Backend",defaultValue:"webgl2"})),e.addSelect("Renderer","renderer",["rasterizer","pathtracer"],getStartValueSelect({name:"Renderer",defaultValue:"rasterizer"})),console.log(config),(e=new ConfigForm(t,config,a)).addSelect("Antialiasing","antialiasing",["none","fxaa","taa"],getStartValueSelect({name:"Antialiasing",defaultValue:"fxaa"})),e.addCheckbox("Temporal averaging","temporal",!0),e.addCheckbox("HDR","hdr",getStartValueCheckbox({name:"HDR",defaultValue:!0})),e.addSlider("Render quality","renderQuality",.1,2,.1,getStartValueSlider({name:"Render quality",defaultValue:1})),e.addSlider("Samples per ray","samplesPerRay",1,32,1,getStartValueSlider({name:"samplesPerRay",defaultValue:1})),e.addSlider("Max reflections","maxReflections",1,16,1,getStartValueSlider({name:"Max reflections",defaultValue:5})),e.addSlider("Min importancy","minImportancy",0,1,.01,getStartValueSlider({name:"Min importancy",defaultValue:.3}))):console.error("Script or parameter form not found")});